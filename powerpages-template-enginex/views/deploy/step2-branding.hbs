<section class="deploy-section">
    <div class="container">
        <div class="deploy-wizard">
            <div class="wizard-progress">
                <div class="progress-step completed"><span class="step-number">âœ“</span><span class="step-label">Theme</span></div>
                <div class="progress-connector completed"></div>
                <div class="progress-step active"><span class="step-number">2</span><span class="step-label">Branding</span></div>
                <div class="progress-connector"></div>
                <div class="progress-step"><span class="step-number">3</span><span class="step-label">Target</span></div>
                <div class="progress-connector"></div>
                <div class="progress-step"><span class="step-number">4</span><span class="step-label">Deploy</span></div>
            </div>

            <div class="wizard-content">
                <h1>Configure Branding</h1>
                <p>Apply your organization's branding to the deployed theme</p>

                <form action="/deploy/step3" method="POST">
                    <input type="hidden" name="_csrf" value="{{csrfToken}}">

                    <!-- Theme Summary -->
                    {{#if galleryTheme}}
                    <div class="selected-theme-summary">
                        <img src="{{galleryTheme.previewImage}}" alt="{{galleryTheme.name}}" style="width: 100px; border-radius: 0.375rem;">
                        <div>
                            <h3>{{galleryTheme.name}}</h3>
                            <p>{{galleryTheme.description}}</p>
                        </div>
                    </div>
                    {{/if}}

                    <div class="form-group">
                        <label for="themeName">Theme Name</label>
                        <input type="text" id="themeName" name="themeName" value="{{themeName}}" required>
                    </div>

                    <!-- Organization Selection -->
                    <div class="form-section">
                        <h3>Organization</h3>
                        <p class="form-section-desc">Select an organization to apply branding from</p>

                        {{#if organizations.length}}
                        <div class="form-group">
                            <label for="organizationId">Select Organization</label>
                            <select id="organizationId" name="organizationId" class="form-control">
                                <option value="">No organization (personal)</option>
                                {{#each organizations}}
                                <option value="{{this._id}}" {{#if (eq this._id ../organization._id)}}selected{{/if}}>
                                    {{this.name}}
                                </option>
                                {{/each}}
                            </select>
                        </div>
                        {{else}}
                        <div class="empty-state-small">
                            <p>You don't have any organizations yet.</p>
                            <a href="/organization/create" class="btn-outline btn-sm" target="_blank">Create Organization</a>
                        </div>
                        {{/if}}
                    </div>

                    <!-- Branding Preview -->
                    {{#if organization}}
                    <div class="form-section" id="brandingPreview">
                        <h3>Organization Branding</h3>
                        
                        <div class="branding-preview-card">
                            <div class="preview-row">
                                <div class="preview-item">
                                    <label>Logo</label>
                                    {{#if organization.branding.logo.url}}
                                    <img src="{{organization.branding.logo.url}}" alt="Logo" style="max-height: 50px;">
                                    {{else}}
                                    <span class="text-muted">Not set</span>
                                    {{/if}}
                                </div>
                                <div class="preview-item">
                                    <label>Colors</label>
                                    <div class="color-swatches">
                                        <span class="swatch" style="background: {{default organization.branding.colors.primary '#2563eb'}};" title="Primary"></span>
                                        <span class="swatch" style="background: {{default organization.branding.colors.secondary '#1e40af'}};" title="Secondary"></span>
                                        <span class="swatch" style="background: {{default organization.branding.colors.accent '#06b6d4'}};" title="Accent"></span>
                                    </div>
                                </div>
                            </div>
                            <a href="/organization/{{organization._id}}/branding" target="_blank" class="btn-outline btn-sm">Edit Branding</a>
                        </div>

                        <div class="form-group" style="margin-top: 1rem;">
                            <label class="checkbox-label">
                                <input type="checkbox" name="applyBranding" value="true" checked>
                                <span>Apply organization branding to deployed theme</span>
                            </label>
                            <span class="form-hint">Logos, colors, and fonts will be injected into the theme</span>
                        </div>
                    </div>
                    {{/if}}

                    <!-- What gets applied -->
                    <div class="form-section">
                        <h3>What Gets Applied</h3>
                        <div class="feature-list">
                            <div class="feature-item">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                <span>Logo replacement (supports placeholders in theme)</span>
                            </div>
                            <div class="feature-item">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                <span>CSS color variables (--brand-primary, etc.)</span>
                            </div>
                            <div class="feature-item">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                <span>Font family settings</span>
                            </div>
                            <div class="feature-item">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                <span>Organization name replacement</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <a href="/deploy" class="btn-outline">Back</a>
                        <button type="submit" class="btn-primary">Continue to Target Selection</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<style>
.selected-theme-summary {
    display: flex;
    gap: 1rem;
    align-items: center;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 0.5rem;
    margin-bottom: 1.5rem;
}
.selected-theme-summary h3 { margin: 0; }
.selected-theme-summary p { margin: 0.25rem 0 0; color: #64748b; font-size: 0.875rem; }
.branding-preview-card {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 0.5rem;
}
.preview-row {
    display: flex;
    gap: 2rem;
    margin-bottom: 1rem;
}
.preview-item label {
    display: block;
    font-size: 0.75rem;
    color: #64748b;
    margin-bottom: 0.5rem;
}
.color-swatches {
    display: flex;
    gap: 0.5rem;
}
.swatch {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
.feature-list {
    display: grid;
    gap: 0.75rem;
}
.feature-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: #374151;
}
.feature-item svg { color: #16a34a; flex-shrink: 0; }
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}
.checkbox-label input { width: auto; }
</style>
